; =================================================================
; ФАЙЛ: kernel_entry.asm
; Описание: Ассемблерный враппер (обертка) для ядра C.
;           Гарантирует, что C-функция kernel_main вызывается корректно.
; =================================================================
 
[BITS 32]
; Объявляем функцию kernel_main как внешнюю (она находится в kernel.c)
extern kernel_main

; Точка входа в ядро (куда прыгает loader.asm)
section .text
global _start
_start:
    ; Инициализация стекового указателя (ESP)
    ; Стек уже установлен loader'ом на 0x90000, но лучше перестраховаться
    ; Если вы используете 'mov esp, 0x90000' в loader'е, то этот шаг
    ; в kernel_entry.asm не является строго необходимым, но безопасен.
    
    ; Инициализация EBP (Base Pointer), требуется для корректного C-фрейма
    mov ebp, esp 

    ; Вызываем функцию ядра C
    call kernel_main

    ; Если ядро C вернуло управление, просто зависаем
    jmp $